"use strict";const injectCode=t=>{const e=document.createElement("script");e.textContent=t,(document.head||document.documentElement).appendChild(e)},forceHTMLFallback=()=>{const t=`(function() {window['_docs_force_html_by_ext'] ='${chrome.runtime.id}';})();`;injectCode(t)},injectCSSRule=(t,e)=>{const i=document.createElement("style");document.head.appendChild(i);const n=i.sheet;n.insertRule?n.insertRule(`${t} { ${e} }`,0):n.addRule&&n.addRule(t,e,0)},overrideCanvasRender=()=>{const t={SQUIGGLE_COLORS:["#4285f4","#dd0000","rgba(255, 255, 255, 0.850980392156863)"],HIGHLIGHT_COLORS:["#fce8e6","#e8f0fe"],PATTERN_OFFSET:2};CanvasRenderingContext2D.prototype._msSaveContext=function(){try{this.msExtraContext||(this.msExtraContext=[]);const{strokeStyle:t,fillStyle:e,globalAlpha:i,lineWidth:n,lineCap:s,lineJoin:o,miterLimit:a,lineDashOffset:r,shadowOffsetX:l,shadowOffsetY:h,shadowBlur:c,shadowColor:d,globalCompositeOperation:g,font:p,textAlign:u,textBaseline:f,direction:C,imageSmoothingEnabled:m}=this,x=this.getTransform();this.msExtraContext.push({strokeStyle:t,fillStyle:e,globalAlpha:i,lineWidth:n,lineCap:s,lineJoin:o,miterLimit:a,lineDashOffset:r,shadowOffsetX:l,shadowOffsetY:h,shadowBlur:c,shadowColor:d,globalCompositeOperation:g,font:p,textAlign:u,textBaseline:f,direction:C,imageSmoothingEnabled:m,transform:x})}catch(t){console.error(t)}},CanvasRenderingContext2D.prototype._msRestoreContext=function(){try{const{strokeStyle:t,fillStyle:e,globalAlpha:i,lineWidth:n,lineCap:s,lineJoin:o,miterLimit:a,lineDashOffset:r,shadowOffsetX:l,shadowOffsetY:h,shadowBlur:c,shadowColor:d,globalCompositeOperation:g,font:p,textAlign:u,textBaseline:f,direction:C,imageSmoothingEnabled:m,transform:x}=this.msExtraContext.pop();this.setTransform(x),this.strokeStyle=t,this.fillStyle=e,this.globalAlpha=i,this.lineWidth=n,this.lineCap=s,this.lineJoin=o,this.miterLimit=a,this.lineDashOffset=r,this.shadowOffsetX=l,this.shadowOffsetY=h,this.shadowBlur=c,this.shadowColor=d,this.globalCompositeOperation=g,this.font=p,this.textAlign=u,this.textBaseline=f,this.direction=C,this.imageSmoothingEnabled=m}catch(t){console.error(t)}},CanvasRenderingContext2D.prototype._fillRect=CanvasRenderingContext2D.prototype.fillRect,CanvasRenderingContext2D.prototype.fillRect=function(e,i,n,s){try{if(t.HIGHLIGHT_COLORS.includes(this.fillStyle)){this.msExtrasHighlightRects||(this.msExtrasHighlightRects=[]);const t={x:e,y:i,width:n,height:s,transform:this.getTransform()};return this.msExtrasHighlightRects.push(t),void this._msSaveContext()}}catch(t){console.error(t)}return this._fillRect(e,i,n,s)},CanvasRenderingContext2D.prototype._beginPath=CanvasRenderingContext2D.prototype.beginPath,CanvasRenderingContext2D.prototype.beginPath=function(){try{this.msEditorExtras={previousX:null,previousY:null,initialY:null,initialX:null,breaksSquigglePattern:!1,lineCount:0}}catch(t){console.error(t)}return this._beginPath()},CanvasRenderingContext2D.prototype._lineTo=CanvasRenderingContext2D.prototype.lineTo,CanvasRenderingContext2D.prototype.lineTo=function(e,i){try{let n=this.msEditorExtras;n&&!n.breaksSquigglePattern&&(n.previousX&&n.previousY?n.breaksSquigglePattern=t.PATTERN_OFFSET!==Math.abs(e-n.previousX)||t.PATTERN_OFFSET!==Math.abs(i-n.previousY):(n.initialX=e-t.PATTERN_OFFSET,n.initialY=i+t.PATTERN_OFFSET),n.previousX=e,n.previousY=i,n.lineCount++)}catch(t){console.error(t)}return this._lineTo(e,i)},CanvasRenderingContext2D.prototype._stroke=CanvasRenderingContext2D.prototype.stroke,CanvasRenderingContext2D.prototype.stroke=function(e){try{const e=this.msEditorExtras;if(e&&e.lineCount>1&&!e.breaksSquigglePattern&&t.SQUIGGLE_COLORS.includes(this.strokeStyle)){const i=this.getTransform();return void(this.msExtrasHighlightRects&&(this.msExtrasHighlightRects=this.msExtrasHighlightRects.filter(({x:n,y:s,width:o,height:a,transform:{a:r,d:l,e:h,f:c}})=>!(Math.abs(i.e/i.a+e.initialX-(h/r+n))<=t.PATTERN_OFFSET&&Math.abs(i.f/i.d+e.initialY-(c/l+s+a))<=t.PATTERN_OFFSET&&Math.abs(e.previousX-e.initialX-o)<=t.PATTERN_OFFSET))))}}catch(t){console.error(t)}return e?this._stroke(e):this._stroke()},CanvasRenderingContext2D.prototype._fillText=CanvasRenderingContext2D.prototype.fillText,CanvasRenderingContext2D.prototype.fillText=function(t,e,i,n){try{if(this.msExtrasHighlightRects){this.save();for(let t=this.msExtrasHighlightRects.length-1;t>=0;t--){this._msRestoreContext();const{x:e,y:i,width:n,height:s}=this.msExtrasHighlightRects[t];this._fillRect(e,i,n,s)}this.restore(),this.msExtrasHighlightRects=null,this.msExtraContext=null}}catch(t){console.error(t)}return n?this._fillText(t,e,i,n):this._fillText(t,e,i)}},suppressNativeSquiggles=()=>{injectCode(`(${overrideCanvasRender})();`),injectCSSRule(".kix-spellcheck-with-explanation-bubble","display: none !important;")},enableAnnotatedCanvas=()=>{const t="hokifickgkhplphjiodbggjmoafhignh";let e=chrome.runtime.id;"gpaiobkfhnonedkhhfjpmhdalgeoebfa"!==chrome.runtime.id&&chrome.runtime.id!==t&&(e=t);injectCode(`(function() {window['_docs_annotate_canvas_by_ext'] ='${e}';})();`)},processFeatureFlags=t=>{const e=t.featureFlags?JSON.parse(t.featureFlags):void 0,i=e&&e.value?JSON.parse(e.value):void 0;i&&(!0!==i.enableGDocsSuppressNativeSquiggles&&"True"!==i.enableGDocsSuppressNativeSquiggles||(injectCode(`(${overrideCanvasRender})();`),injectCSSRule(".kix-spellcheck-with-explanation-bubble","display: none !important;")),!0!==i.enableGDocsAnnotatedCanvas&&"True"!==i.enableGDocsAnnotatedCanvas?forceHTMLFallback():enableAnnotatedCanvas())},useHTMLorCanvas=()=>{chrome.storage.local.get(["featureFlags"],processFeatureFlags)};chrome.storage.local.get(["featureFlags"],processFeatureFlags);