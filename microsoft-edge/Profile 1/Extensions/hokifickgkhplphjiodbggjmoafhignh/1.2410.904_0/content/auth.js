"use strict";const isIFrame=window.parent!==window;function log(t){const n=(()=>{const t=(new Error).stack.split("\n");if(t.length<4)return;return t[3].match(/\b[\w\.]+\b:\d+/g).pop()})();chrome.runtime.sendMessage({activity:"log",log:`${isIFrame?"(iframe)":""}${n||""}: ${t}`})}function notifyAuthentication(t,n){const o={activity:"authorization",origin:window.location.origin,close:!0,eventId:"authorization",data:[{address:void 0}]};Object.assign(o,n),location.hash="",BrowserHandler.runtime.sendMessage(o),log(`auth notification type:${t} state:${n.state} scope:${n.scope}`)}function isResponse(){return location.hash.length>0}function parseParams(t){const n=t.split(/[?#]/);if(n.length<2)return{};t=n[1];const o=new URLSearchParams(t),i={};for(const[t,n]of o.entries())i[t]=n;if(n.length>=3){const t=n[2],o=new URLSearchParams(t);for(const[t,n]of o.entries())i[t]=n}return i}log("navigated to: "+location.href),window.addEventListener("load",()=>{const t=parseParams(location.href);t.state&&t.state.includes("EditorExtension")&&("https://login.microsoftonline.com"===window.location.origin?t.code?notifyAuthentication("o365UserService",t):isResponse()&&"/common/oauth2/nativeclient"===location.pathname&&notifyAuthentication("msidUserService",t):"https://login.live.com"===window.location.origin&&(t.code?notifyAuthentication("msaUserService",t):"/oauth20_authorize"===location.pathname&&notifyAuthentication("msidUserService",t)))});