/*! For license information please see 239.js.LICENSE.txt */
"use strict";(self.webpackChunkjump_cutter=self.webpackChunkjump_cutter||[]).push([[239],{6239:(e,t,s)=>{s.d(t,{default:()=>h});var a=s(3452),d=s(6577),n=s(7029);class i{constructor(){const e=Date.now();this._countSinceMs=e,this._pausedAtMs=e}_getTime(e){return((this._pausedAtMs??e)-this._countSinceMs)/1e3}get time(){return this._getTime(Date.now())}getTimeAndReset(){const e=Date.now(),t=this._getTime(e);return this._countSinceMs=e,this._pausedAtMs&&(this._pausedAtMs=e),t}pause(){this._pausedAtMs||(this._pausedAtMs=Date.now())}resume(){if(!this._pausedAtMs)return;const e=Date.now();this._countSinceMs+=e-this._pausedAtMs,this._pausedAtMs=null}}class o{constructor(e){this._stopwatch=new i,this.getTimeAndReset=()=>this._stopwatch.getTimeAndReset(),(0,d.c0)(e)&&this._stopwatch.resume();const t=(0,d.P7)(e,(()=>this._stopwatch.pause())),s=(0,d.gg)(e,(()=>this._stopwatch.resume()));this.destroy=()=>{t(),s()}}get time(){return this._stopwatch.time}}class h{constructor(e,t,s,d){this.element=e,this._timeSavedComparedToSoundedSpeed=0,this._timeSavedComparedToIntrinsicSpeed=0,this._wouldHaveLastedIfSpeedWasSounded=0,this._wouldHaveLastedIfSpeedWasIntrinsic=0,this._destroyedPromise=new Promise((e=>this.destroy=e)),this._onElementSpeedChange=()=>{const e=this._currentElementSpeed,t=this.element.playbackRate;e!==t&&(this._appendLastSnippetData(e,this._lastHandledSoundedSpeed),this._currentElementSpeed=t)},this._onSettingsChange=e=>{const t=e.soundedSpeed;t&&this._onSoundedSpeedChange(t.newValue);const s=(0,a.P)(e);this._setStateAccordingToNewSettings(s)},this._lastHandledSoundedSpeed=t.soundedSpeed,this._setStateAccordingToNewSettings(t),this._playbackStopwatch=new o(this.element),s(this._onSettingsChange),e.addEventListener("ratechange",this._onElementSpeedChange,{passive:!0}),this._destroyedPromise.then((()=>{this._playbackStopwatch.destroy(),d(this._onSettingsChange),e.removeEventListener("ratechange",this._onElementSpeedChange)})),this._currentElementSpeed=e.playbackRate}_getTimeSavedData(e,t,s){const a=e,[d,i,o,h]=function(e,t,s){const a=t===(0,n.J)(1)?1:t,d=a/s;return[e*(d-1),e*(a-1),d*e,a*e]}(a,t,s);if("exponential"===this._averagingMethod){const t=Math.E**(-e/this._decayTimeConstant),s=this._decayTimeConstant*(1-t),n=(e,d)=>e*t+s*d/(a||1);return[n(this._timeSavedComparedToSoundedSpeed,d),n(this._timeSavedComparedToIntrinsicSpeed,i),n(this._wouldHaveLastedIfSpeedWasSounded,o),n(this._wouldHaveLastedIfSpeedWasIntrinsic,h)]}return[this._timeSavedComparedToSoundedSpeed+d,this._timeSavedComparedToIntrinsicSpeed+i,this._wouldHaveLastedIfSpeedWasSounded+o,this._wouldHaveLastedIfSpeedWasIntrinsic+h]}_appendLastSnippetData(e,t){const s=this._playbackStopwatch.getTimeAndReset(),[a,d,n,i]=this._getTimeSavedData(s,e,t);this._timeSavedComparedToSoundedSpeed=a,this._timeSavedComparedToIntrinsicSpeed=d,this._wouldHaveLastedIfSpeedWasSounded=n,this._wouldHaveLastedIfSpeedWasIntrinsic=i}onControllerCausedSeek(e,t){this._appendLastSnippetData(this._currentElementSpeed,this._lastHandledSoundedSpeed);const s=e,a=e/this._currentElementSpeed,d=s-t*this._currentElementSpeed,n=d/this._currentElementSpeed;this._timeSavedComparedToSoundedSpeed+=n,this._timeSavedComparedToIntrinsicSpeed+=d,this._wouldHaveLastedIfSpeedWasSounded+=a,this._wouldHaveLastedIfSpeedWasIntrinsic+=s}_setStateAccordingToNewSettings({timeSavedAveragingMethod:e,timeSavedAveragingWindowLength:t,timeSavedExponentialAveragingLatestDataWeight:s}){this._averagingMethod=e??this._averagingMethod,void 0===t&&void 0===s||(this._latestDataLength=t??this._latestDataLength,this._latestDataWeight=s??this._latestDataWeight,this._decayTimeConstant=function(e,t){const s=e/(1-e);return t/Math.log(s+1)}(this._latestDataWeight,this._latestDataLength))}_onSoundedSpeedChange(e){const t=this._lastHandledSoundedSpeed;this._appendLastSnippetData(this._currentElementSpeed,t),this._lastHandledSoundedSpeed=e}get timeSavedData(){const e=this._playbackStopwatch.time,[t,s,a,d]=this._getTimeSavedData(e,this._currentElementSpeed,this._lastHandledSoundedSpeed);return{timeSavedComparedToSoundedSpeed:t,timeSavedComparedToIntrinsicSpeed:s,wouldHaveLastedIfSpeedWasSounded:a,wouldHaveLastedIfSpeedWasIntrinsic:d}}}}}]);