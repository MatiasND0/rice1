/*! For license information please see 356.js.LICENSE.txt */
"use strict";(self.webpackChunkjump_cutter=self.webpackChunkjump_cutter||[]).push([[356],{8356:(e,t,s)=>{s.d(t,{default:()=>f});var i=s(1647),n=s(2526),r=s(8757),o=s(5057),h=s(3779);function a(e,t,s){return e+t+s}var c=s(5406),d=s(5418),l=s(6577),u=s(2803),m=s(1208),_=s(2854),y=s(4149),g=s(7764);function p(e){return e.marginBefore>0}const S=o.$;class P{constructor(e,t,s){this.initialized=!1,this._initPromise=new Promise((e=>this._resolveInitPromise=e)),this._destroyedPromise=new Promise((e=>this._resolveDestroyedPromise=e)),this._didNotDoDesyncCorrectionForNSpeedSwitches=0,this.element=e,this.settings=t}isInitialized(){return this.initialized}isStretcherEnabled(){return p(this.settings)}async init(){const e=this.element,t=[],{playbackRate:o,defaultPlaybackRate:c}=e;this._destroyedPromise.then((()=>{(0,y.Nz)(e,o),(0,y.y1)(e,c)})),this.audioContext=n.e;const d=e=>n.e.audioWorklet.addModule(i.y.runtime.getURL(e)),l=d("content/VolumeFilterProcessor.js").then((()=>{const e=new _.A(n.e,.03,.03);return this._destroyedPromise.then((()=>(0,h.h)(e))),e})),u=d("content/SilenceDetectorProcessor.js").then((()=>{const e=new m.A(n.e,this._getSilenceDetectorNodeDurationThreshold());return this._silenceDetectorNode=e,this._destroyedPromise.then((()=>(0,h.h)(e))),this._destroyedPromise.then((()=>e.port.close())),e}));if(this._analyzerIn=n.e.createAnalyser(),this._analyzerIn.fftSize=32,this._volumeInfoBuffer=new Float32Array(this._analyzerIn.fftSize),this.isStretcherEnabled()){this._lookahead=n.e.createDelay(2);const e=(await Promise.all([s.e(838),s.e(553)]).then(s.bind(s,7553))).default,t=n.e.sampleRate/8e3/.25*2;this._stretcherAndPitch=new e(n.e,t,0,(()=>this.settings),(()=>this._lookahead.delayTime.value)),this._destroyedPromise.then((()=>this._stretcherAndPitch.destroy()))}{const t=()=>n.e.suspend();let s;const i=()=>{clearTimeout(s);const e=a(this._lookahead?.delayTime.value??0,this._stretcherAndPitch?.stretcherDelay??0,this._stretcherAndPitch?.pitchCorrectorDelay??0);s=setTimeout(t,1e3*(e+.02))},r=()=>{clearTimeout(s),n.e.resume()};e.paused&&t(),e.addEventListener("pause",i,{passive:!0}),e.addEventListener("play",r,{passive:!0}),this._destroyedPromise.then((()=>{e.removeEventListener("pause",i),e.removeEventListener("play",r),r()}))}const[,p]=(0,r.n)(e,(()=>n.e));let S=p;return this.isStretcherEnabled()&&(p.connect(this._lookahead),this._stretcherAndPitch.connectInputFrom(this._lookahead),S=this._stretcherAndPitch),t.push(l.then((async e=>{p.connect(e),this._destroyedPromise.then((()=>{p.connect(e),p.disconnect(e)})),e.connect(this._analyzerIn);const t=await u;e.connect(t)}))),S.connect(n.e.destination),this._destroyedPromise.then((()=>{p.disconnect(),p.connect(n.e.destination)})),t.push(u.then((t=>{t.port.onmessage=({data:t})=>{const[s]=t;let i;if(0===s)i=this._setSpeedAndLog(0),this._stretcherAndPitch?.onSilenceEnd(i);else if(i=this._setSpeedAndLog(1),this._stretcherAndPitch?.onSilenceStart(i),g.H&&this.settings.enableDesyncCorrection){const t=10;this._didNotDoDesyncCorrectionForNSpeedSwitches++,this._didNotDoDesyncCorrectionForNSpeedSwitches>=t&&!e.ended&&(e.currentTime-=1e-9,this._didNotDoDesyncCorrectionForNSpeedSwitches=0)}},this._destroyedPromise.then((()=>t.port.onmessage=null))}))),await Promise.all(t),this.initialized=!0,this._resolveInitPromise(this),Object.assign(this.settings,this._pendingSettingsUpdates),this._setStateAccordingToNewSettings(this.settings,null),delete this._pendingSettingsUpdates,this}async destroy(){await this._initPromise,(0,u.K)(this.isInitialized()),this._resolveDestroyedPromise()}_setStateAccordingToNewSettings(e,t){this.settings=e,(0,u.K)(this.isInitialized()),(0,y.y1)(this.element,S(this.settings.soundedSpeed,this.settings.volumeThreshold)),t?this._setSpeedAndLog(this._lastActualPlaybackRateChange.name):(this._lastActualPlaybackRateChange={name:0,time:0,value:1},this._setSpeedAndLog(0)),this._silenceDetectorNode.volumeThreshold=this.settings.volumeThreshold,this._silenceDetectorNode.durationThreshold=this._getSilenceDetectorNodeDurationThreshold(),this.isStretcherEnabled()&&(this._lookahead.delayTime.value=function(...e){return function(e,t,s){return e/Math.max(t,s)}(...e)+.01}(this.settings.marginBefore,this.settings.soundedSpeed,this.settings.silenceSpeed),this._stretcherAndPitch.onSettingsUpdate())}updateSettingsAndMaybeCreateNewInstance(e){const t=this.settings;if(p(e)?!p(t):p(t)){const t=new P(this.element,e,void 0);return this.destroy().then((()=>t.init())),t}return this.initialized?this._setStateAccordingToNewSettings(e,t):this._pendingSettingsUpdates=e,this}_getSilenceDetectorNodeDurationThreshold(){const e=this.settings.marginBefore;return(0,u.K)(this.isStretcherEnabled()?e>0:0===e,"Currently the stretcher should only be enabled when marginBefore > 0 and vice versa?"),(0,c.I)(this.settings.marginAfter+e,this.settings.soundedSpeed)}_setSpeedAndLog(e){const t=S(0===e?this.settings.soundedSpeed:this.settings.silenceSpeed,this.settings.volumeThreshold);(0,y.Nz)(this.element,t);const s=this.audioContext.currentTime,i=this._lastActualPlaybackRateChange;return(0,u.K)(i),i.time=s,i.value=t,i.name=e,s}get telemetry(){(0,u.K)(this.isInitialized()),this._analyzerIn.getFloatTimeDomainData(this._volumeInfoBuffer);const e=this._volumeInfoBuffer[this._volumeInfoBuffer.length-1],t=this._lookahead?.delayTime.value??0,s=this._stretcherAndPitch?.stretcherDelay??0;return{unixTime:Date.now()/1e3,intrinsicTime:this.element.currentTime,elementPlaybackActive:(0,l.c0)(this.element),contextTime:this.audioContext.currentTime,inputVolume:e,lastActualPlaybackRateChange:this._lastActualPlaybackRateChange,elementVolume:this.element.volume,totalOutputDelay:a(t,s,this._stretcherAndPitch?.pitchCorrectorDelay??0),delayFromInputToStretcherOutput:(0,d.M)(t,s),stretcherDelay:s,lastScheduledStretchInputTime:this._stretcherAndPitch?.lastScheduledStretch&&(i=this._stretcherAndPitch.lastScheduledStretch,{...i,startTime:i.startTime-(0,d.M)(t,i.startValue),endTime:i.endTime-(0,d.M)(t,i.endValue)})};var i}}P.controllerType=1;const f=P},5418:(e,t,s)=>{function i(e,t){return e+t}s.d(t,{M:()=>i})}}]);