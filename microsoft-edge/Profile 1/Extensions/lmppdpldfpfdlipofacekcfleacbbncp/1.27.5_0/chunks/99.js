/*! For license information please see 99.js.LICENSE.txt */
"use strict";(self.webpackChunkjump_cutter=self.webpackChunkjump_cutter||[]).push([[99],{99:(e,t,s)=>{s.d(t,{default:()=>A});var i=s(1647),n=s(7891),r=s(2803),o=s(6717),a=s(3779),h=s(5406),d=s(8059),c=s.n(d),l=s(7350),u=s.n(l),m=s(1208),p=s(2854),y=s(8757);const S=Math.min(8,n.c),g=Math.min(4,n.c);class v{constructor(e,t,s,i){this.originalElement=e,this.settings=t,this.getFallbackCloneElement=s,this.onClonePlaybackError=i,this.silenceRanges={starts:[],ends:[]},this._destroyedPromise=new Promise((e=>this._resolveDestroyedPromise=e)),this.ensureInit=c()(this._init)}async _init(){const e=this.originalElement,t=async function(e,t){const s=function(e){const t=document.createElement("audio");t.crossOrigin=e.crossOrigin;const{currentSrc:s}=e;if(s)t.src=s;else{const{srcObject:s}=e;if(!s)return t;t.srcObject=s}return t}(e);if(await async function(e){return new Promise((t=>{const s=e.muted,i=()=>r(!0),n=()=>r(!1),r=r=>{t(r),e.pause(),e.muted=s,e.removeEventListener("error",n),e.removeEventListener("canplay",i)};e.readyState>=HTMLMediaElement.HAVE_FUTURE_DATA?r(!0):(e.addEventListener("canplay",i,{once:!0,passive:!0}),e.error?r(!1):(e.addEventListener("error",n,{once:!0,passive:!0}),e.muted=!0,e.play()))}))}(s))return[s,!1];if(t&&function(e){const{currentSrc:t}=e;if(!t){const{srcObject:t}=e;return!!t&&t instanceof MediaSource}return!!t.startsWith("blob:")}(e)){const s=await t(e);if(s)return[s,!0]}return[s,!1]}(e,this.getFallbackCloneElement),[s,n]=await t,h=n;this.clone=s,s.error&&this.onClonePlaybackError(),s.addEventListener("error",this.onClonePlaybackError,{passive:!0}),this._destroyedPromise.then((()=>s.removeEventListener("error",this.onClonePlaybackError))),h?this._destroyedPromise.then((()=>{s.pause()})):this._destroyedPromise.then((()=>s.src=""));const d=[],[c,l]=(0,y.n)(s,(()=>new AudioContext({latencyHint:"playback"})));h?this._destroyedPromise.then((()=>c.suspend())):this._destroyedPromise.then((()=>c.close())),c.suspend();const v=e=>c.audioWorklet.addModule(i.y.runtime.getURL(e)),k=v("content/VolumeFilterProcessor.js").then((()=>{const e=new p.A(c,.05,.05);return this._destroyedPromise.then((()=>(0,a.h)(e))),e})),_=this._getSilenceDetectorNodeDurationThreshold(),E=v("content/SilenceDetectorProcessor.js").then((()=>{const e=new m.A(c,_);return this._destroyedPromise.then((()=>(0,a.h)(e))),e}));d.push(k.then((async e=>{l.connect(e);const t=await E;e.connect(t)}))),d.push(E.then((e=>{e.volumeThreshold=this.settings.volumeThreshold,e.port.onmessage=t=>{const[i,n]=t.data,o=c.currentTime-n;if(1===i){const t=(o+e.durationThreshold+.025)*s.playbackRate,i=s.currentTime-t;this.silenceSince=i}else{(0,r.K)(null!=this.silenceSince,"Thought `this.silenceSince` to be set because SilenceDetector was thought to always send `SilenceDetectorEventType.SILENCE_START` before `SILENCE_END`");const e=(o+.025)*s.playbackRate,t=s.currentTime-e;this.pushNewSilenceRange(this.silenceSince+this.settings.marginAfter,t-this.settings.marginBefore),this.silenceSince=void 0}}})));const P=()=>{null==this.silenceSince||this.silenceSince!==s.duration&&((0,r.K)(this.silenceSince),this.pushNewSilenceRange(this.silenceSince+this.settings.marginAfter,s.duration))};s.addEventListener("ended",P,{passive:!0}),this._destroyedPromise.then((()=>s.removeEventListener("ended",P))),s.preservesPitch=!1,await Promise.all(d);const T=s.fastSeek?e=>s.fastSeek(e):e=>{s.currentTime=e},b=u()((()=>{const t=e.currentTime;(function(e,t){for(let s=0;s<e.length;s++){const i=e.start(s),n=e.end(s);if(i<=t&&t<=n)return!0}return!1})(s.played,t)||(T(t),null!=this.silenceSince&&(this.silenceSince=t))}),1e3);h?T(e.currentTime):b(),e.addEventListener("seeking",b,{passive:!0}),this._destroyedPromise.then((()=>{e.removeEventListener("seeking",b)}));{const t=()=>e.addEventListener("timeupdate",n,{once:!0,passive:!0});let i=-1;const n=()=>{const n=s.currentTime-e.currentTime,r=h?g:S,a=r*(1-n/(h?120:180));s.playbackRate=(0,o.q)(a,2,r),E.then((e=>{e.durationThreshold=this._getSilenceDetectorNodeDurationThreshold()})),i=setTimeout(t,3e3)};n(),this._destroyedPromise.then((()=>{e.removeEventListener("timeupdate",n),clearTimeout(i)}))}const L=()=>{c.resume()},f=()=>{c.suspend()};s.paused||L(),s.addEventListener("pause",f,{passive:!0}),s.addEventListener("play",L,{passive:!0}),this._destroyedPromise.then((()=>{s.removeEventListener("pause",f),s.removeEventListener("play",L)}));const A=()=>{s.play()},w=()=>{s.pause()};e.paused||A(),e.addEventListener("pause",w,{passive:!0}),e.addEventListener("play",A,{passive:!0}),this._destroyedPromise.then((()=>{e.removeEventListener("pause",w),e.removeEventListener("play",A)}))}_getSilenceDetectorNodeDurationThreshold(){return(0,h.I)(this.settings.marginAfter+this.settings.marginBefore,this.clone.playbackRate)}getNextSilenceRange(e){const{starts:t,ends:s}=this.silenceRanges,i=s.length;let n,r=1/0;for(let t=0;t<i;t++){const i=s[t];i>e&&i<r&&(r=i,n=t)}if(void 0!==n)return[[t[n],s[n]],!1];{const{silenceSince:t}=this;if(null==t)return;if(!this.clone)return;const s=this.clone.currentTime-this.settings.marginBefore-.05;if(e<s)return[[t+this.settings.marginAfter,s],!0]}}pushNewSilenceRange(e,t){t-e<.01||(this.silenceRanges.starts.push(e),this.silenceRanges.ends.push(t))}async destroy(){await this.ensureInit(),this._resolveDestroyedPromise()}}var k=s(5057),_=s(4866),E=s(6577),P=s(4149),T=s(7764);class b{constructor(e){this.history=[],this.historyAverage=150,this._destroyedPromise=new Promise((e=>this.destroy=e)),this.lastSeekStartTime=performance.now(),this.el=e;const t=this.onSeeking.bind(this),s=this.onSeeked.bind(this);e.addEventListener("seeking",t,{passive:!0}),e.addEventListener("seeked",s,{passive:!0}),this._destroyedPromise.then((()=>{e.removeEventListener("seeking",t),e.removeEventListener("seeked",s)}))}onSeeking(e){this.lastSeekStartTime=e.timeStamp}onSeeked(e){const t=e.timeStamp-this.lastSeekStartTime;this.history.push(t),this.history.length>5&&this.history.shift();const s=this.history.reduce(((e,t)=>e+t));this.historyAverage=s/this.history.length}get nextSeekDurationMs(){return this.historyAverage}}const L=k.$;class f{constructor(e,t,i){this.initialized=!1,this._initPromise=new Promise((e=>this._resolveInitPromise=e)),this._destroyedPromise=new Promise((e=>this._resolveDestroyedPromise=e)),this.getVolume=()=>0,this._lastActualPlaybackRateChange={name:0,time:0,value:1},this.clonePlaybackError=!1,this._didNotDoDesyncCorrectionForNSpeedSwitches=0,this.getMediaSourceCloneElement=e=>s.e(909).then(s.bind(s,6909)).then((({getMediaSourceCloneElement:t})=>t(e))),this.maybeSeekOrSpeedupTimeoutId=-1,this.maybeSeekOrSpeedupBounded=this.maybeSeekOrSpeedup.bind(this),this._throttledInitLookahead=u()(this._initLookahead,1e3),this.element=e,this.settings=t,(this.lookahead=new v(e,this.settings,this.getMediaSourceCloneElement,(()=>this.clonePlaybackError=!0))).ensureInit(),i instanceof Promise?i.then((e=>this.timeSavedTracker=e)):this.timeSavedTracker=i;const n=this.seekDurationProphet=new b(e);this._destroyedPromise.then((()=>n.destroy()));const r=this.audioContext=new AudioContext({latencyHint:"playback"});this._destroyedPromise.then((()=>{r.close()}))}isInitialized(){return this.initialized}async init(){const e=this.element,t=[],{playbackRate:s,defaultPlaybackRate:n}=e;this._destroyedPromise.then((()=>{(0,P.Nz)(e,s),(0,P.y1)(e,n)})),t.push(this.lookahead.ensureInit().then((()=>{const t=()=>{this.maybeScheduleMaybeSeekOrSpeedup()};e.addEventListener("timeupdate",t,{passive:!0}),this._destroyedPromise.then((()=>e.removeEventListener("timeupdate",t)))})));const r=()=>{this.destroyAndThrottledInitLookahead(),this.seekDurationProphet.destroy();const t=this.seekDurationProphet=new b(e);this._destroyedPromise.then((()=>t.destroy()))};e.addEventListener("loadstart",r,{passive:!0}),this._destroyedPromise.then((()=>e.removeEventListener("loadstart",r)));const o=()=>{this.lookahead?.destroy(),this.lookahead=void 0};e.addEventListener("emptied",o,{passive:!0}),this._destroyedPromise.then((()=>e.removeEventListener("emptied",o)));{const t=e,s=t.captureStream&&(()=>t.captureStream())||!1;if(s){const t=this.audioContext,n=.05,r=t.audioWorklet.addModule(i.y.runtime.getURL("content/VolumeFilterProcessor.js")).then((()=>{const e=new p.A(t,n,n);return this._destroyedPromise.then((()=>(0,a.h)(e))),e}));let o,h=!1;const d=()=>{let e;o?.disconnect();try{e=s()}catch(e){}e&&e.getAudioTracks().length&&(o=t.createMediaStreamSource(e),r.then((e=>o.connect(e)))),h=!1},c=()=>{h||(h=!0,(0,_._)(d,{timeout:2e3}))},l=e.readyState>HTMLMediaElement.HAVE_FUTURE_DATA&&!e.paused;l&&d();let u=!l;const m=()=>{u&&(c(),u=!1)};e.addEventListener("playing",m,{passive:!0}),this._destroyedPromise.then((()=>e.removeEventListener("playing",m)));const y=()=>{u=!0};e.addEventListener("loadstart",y,{passive:!0}),e.addEventListener("ended",y,{passive:!0}),this._destroyedPromise.then((()=>{e.removeEventListener("loadstart",y),e.removeEventListener("ended",y)}));const S=t.createAnalyser();S.fftSize=32,r.then((e=>{e.connect(S)}));const g=new Float32Array(S.fftSize),v=g.length-1;this.getVolume=()=>(S.getFloatTimeDomainData(g),g[v])}else this.getVolume=()=>0}await Promise.all(t),this.initialized=!0,this._resolveInitPromise(this),Object.assign(this.settings,this._pendingSettingsUpdates),this._setStateAccordingToNewSettings(this.settings,null),delete this._pendingSettingsUpdates}maybeScheduleMaybeSeekOrSpeedup(){const{currentTime:e}=this.element,t=this.lookahead?.getNextSilenceRange(e);if(!t)return;const[[s,i],n]=t,r=Math.max(s,e),o=n?Math.max(r,i-3):i;if(n&&o-e<3)return;const a=(r-e)/this.settings.soundedSpeed;clearTimeout(this.maybeSeekOrSpeedupTimeoutId),a<=0?this.maybeSeekOrSpeedup(o,r):this.maybeSeekOrSpeedupTimeoutId=setTimeout(this.maybeSeekOrSpeedupBounded,1e3*a,o,r)}maybeSeekOrSpeedup(e,t){const s=this.element,{currentTime:i,paused:n}=s,r=t;if(Math.abs(i-r)>.5||n)return;const o=e-i,a=this.seekDurationProphet.nextSeekDurationMs/1e3,h=o/this.settings.soundedSpeed,d=h-a,c=o/this.settings.silenceSpeed;let l=h-c;T.H&&this.settings.enableDesyncCorrection&&(l-=a/20);const u=l,m=()=>!!(T.H&&this.settings.enableDesyncCorrection&&this._didNotDoDesyncCorrectionForNSpeedSwitches/20>=1-h/(a||Number.MIN_VALUE)),p=(()=>{const e=e=>m()?2:e;return d>u?d<=0?e(0):2:u<=0?e(0):c<=1/60?d>0?2:e(0):e(1)})();2===p?(s.currentTime=e,this._didNotDoDesyncCorrectionForNSpeedSwitches=0,this.timeSavedTracker?.onControllerCausedSeek(e-i,a),this._lastSilenceSkippingSeek=[t,e]):1===p&&(this._setSpeedAndLog(1),setTimeout((()=>this._setSpeedAndLog(0)),1e3*c),this._didNotDoDesyncCorrectionForNSpeedSwitches++)}async destroy(){await this._initPromise,(0,r.K)(this.isInitialized()),this._throttledInitLookahead.cancel(),this.lookahead?.destroy(),this._resolveDestroyedPromise()}_initLookahead(){(this.lookahead=new v(this.element,this.settings,this.getMediaSourceCloneElement,(()=>this.clonePlaybackError=!0))).ensureInit()}destroyAndThrottledInitLookahead(){this.lookahead?.destroy(),this.lookahead=void 0,this._throttledInitLookahead()}_setStateAccordingToNewSettings(e,t){this.settings=e,(0,r.K)(this.isInitialized()),(0,P.y1)(this.element,L(this.settings.soundedSpeed,this.settings.volumeThreshold)),this._setSpeedAndLog(0),t&&(e.volumeThreshold!==t.volumeThreshold||e.marginBefore!==t.marginBefore||e.marginAfter!==t.marginAfter)&&this.destroyAndThrottledInitLookahead(),e.soundedSpeed!==t?.soundedSpeed&&(clearTimeout(this.maybeSeekOrSpeedupTimeoutId),this.maybeScheduleMaybeSeekOrSpeedup())}updateSettingsAndMaybeCreateNewInstance(e){if(this.initialized){const t=this.settings;this._setStateAccordingToNewSettings(e,t)}else this._pendingSettingsUpdates=e;return this}_setSpeedAndLog(e){const t=L(0===e?this.settings.soundedSpeed:this.settings.silenceSpeed,this.settings.volumeThreshold);(0,P.Nz)(this.element,t);const s=this.audioContext.currentTime,i=this._lastActualPlaybackRateChange;(0,r.K)(i),i.time=s,i.value=t,i.name=e}get telemetry(){return(0,r.K)(this.isInitialized()),{clonePlaybackError:!!this.clonePlaybackError||void 0,unixTime:Date.now()/1e3,intrinsicTime:this.element.currentTime,elementPlaybackActive:(0,E.c0)(this.element),contextTime:this.audioContext.currentTime,inputVolume:this.getVolume(),lastActualPlaybackRateChange:this._lastActualPlaybackRateChange,lastSilenceSkippingSeek:this._lastSilenceSkippingSeek,elementVolume:this.element.volume,totalOutputDelay:0,delayFromInputToStretcherOutput:0,stretcherDelay:0}}}f.controllerType=2;const A=f}}]);